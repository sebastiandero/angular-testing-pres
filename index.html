<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/solarized.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h1>Angular Testing in VIGO NG</h1>
        </section>
        <section>
            <h2>Inhalt</h2>
            <ul>
                <li>Tools</li>
                <li>Angular Testing</li>
                <li>Types of Tests</li>
                <li>VIGO NG Testing</li>
            </ul>
        </section>
        <section>
            <section>
                <h1>Tools</h1>
            </section>
            <section>
                <h2><a href="https://karma-runner.github.io/latest/index.html">Karma</a></h2>

                <pre><code class="bash" data-line-numbers data-trim data-noescape
                           style="font-size: 0.6em !important;">
                    09 04 2019 21:03:33.731:INFO [karma]: <span class="fragment">Karma v1.7.1 server started at http://0.0.0.0:9876/</span>
                    09 04 2019 21:03:33.732:INFO [launcher]: <span class="fragment">Launching browser ChromeCustom with unlimited concurrency</span>
                    09 04 2019 21:03:33.741:INFO [launcher]: <span class="fragment">Starting browser Chrome</span>
                    09 04 2019 21:03:59.049:WARN [karma]: <span class="fragment">No captured browser, open http://localhost:9876/</span>
                    09 04 2019 21:03:59.500:INFO [HeadlessChrome 73.0.3683 (Linux 0.0.0)]: <span class="fragment">Connected on socket ... with id 0</span>
                    <span class="fragment">HeadlessChrome 73.0.3683 (Linux 0.0.0): Executed 81 of 424 SUCCESS (0 secs / 18.735 secs)</span>
                </code></pre>
                <aside class="notes">
                    <ul>
                        <li> 1 Zeile: Karma server</li>
                        <li> 2 Zeile: Karma startet einen browser als client</li>
                        <li> 3 Zeile: Browser startet</li>
                        <li> 4 Zeile: Browser capturing, debugging in chrome etc.</li>
                        <li> 5 Zeile: Socket connection für server -> browser crosstalk</li>
                        <li> 6 Zeile: Tests running</li>
                    </ul>
                    <ul>
                        <li>Test Runner</li>
                        <li>Debugging</li>
                        <li>Browser und Plattform unabhängig</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h2><a href="https://jasmine.github.io/pages/getting_started.html">Jasmine</a></h2>
                <pre><code class="javascript" data-line-numbers data-trim data-noescape
                           style="font-size: 0.8em !important;">
describe("a suite", () => {
  it("should add 2 and 2 to 4", () => {
    expect(2 + 2).toBe(4);
  });

  it("should concatenate strings", () => {
    const a = 'someName';
    expect(`this is my name: ${a}`).toBe('this is my name: someName');
  });
});
                </code></pre>
                <aside class="notes">
                    <ul>
                        <li>Fast</li>
                        <li>BDD for JavaScript</li>
                        <li>Spying</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h2><a href="https://jasmine.github.io/api/3.3/matchers.html">Jasmine Matchers</a></h2>
                <pre><code class="javascript" data-line-numbers data-trim data-noescape>
// not.(other-matcher)
expect(something).not.toBe(true);

// equals
expect(something).toBe(true);

// equals float
expect(something).toBeCloseTo(expected, precision);
expect(number).toBeCloseTo(42.2, 3);

//contains
expect(array).toContain(anElement);

//error
expect(aFunction()).toThrow(anError);</code></pre>
            </section>
            <section>
                <h2><a href="https://github.com/NagRock/ts-mockito">ts-mockito</a></h2>
                <pre><code class="javascript" data-line-numbers data-trim data-noescape>
// from ts-mockito docs:
// Creating mock
let mockedFoo:Foo = mock(Foo);

// stub method before execution
when(mockedFoo.getBar(3)).thenReturn('three');

// Getting instance
let foo:Foo = instance(mockedFoo);

// prints three
console.log(foo.getBar(3));

// verify called
verify(foo.getBar(3)).called();

// prints null, because "getBar(999)" was not stubbed
console.log(foo.getBar(999));</code></pre>
                <aside class="notes">
                    <ul>
                        <li>When to stub methods doesnt matter</li>
                        <li>pass instance to logic</li>
                        <li>use mock to stub and verify</li>
                        <li>can spy on real objects</li>
                        <li>for java developers its basically the same, except for the instance</li>
                    </ul>
                </aside>
            </section>
        </section>
        <section>
            <section>
                <h1>Angular Testing</h1>
            </section>
            <section>
                <h2><a href="https://angular.io/guide/testing#component-test-scenarios">TestBed & Testing Module</a>
                </h2>
                <pre><code class="javascript" data-line-numbers data-trim data-noescape
                           style="font-size: 0.7em !important;">
let component: BannerComponent;
let fixture:   ComponentFixture&lt;BannerComponent&gt;;
let h1:        HTMLElement;

beforeEach(() => {
  TestBed.configureTestingModule({
    declarations: [BannerComponent],
    providers: [],
    imports: []
  });

  fixture = TestBed.createComponent(BannerComponent);
  component = fixture.componentInstance;
  h1 = fixture.nativeElement.querySelector('h1');
});+
                </code></pre>
                <aside class="notes">
                    <ul>
                        <li>Angular Modules for Testing</li>
                        <li>Bootstraps Angular</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h2>Http Client Testing Module</h2>
                <pre><code class="javascript" data-line-numbers data-trim data-noescape
                           style="font-size: 0.7em !important;">
TestBed.configureTestingModule({
    //...
    imports: [HttpClientTestingModule]
});
                </code></pre>
                <pre><code class="javascript" data-line-numbers data-trim data-noescape
                           style="font-size: 0.7em !important;">
const req = controller.expectOne(`myBasePath/gfs/${beilage.gfId}/beilagen`);

expect(req.request.method).toBe('POST');
const body: FormData = req.request.body;
expect(body.get('art')).toBe(beilage.art);
//...
req.flush('A', {headers: new HttpHeaders()});
                </code></pre>
                <aside class="notes">
                    <ul>
                        <li>Can be used to make sure requests are correctly sent to be.</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h2>TestBed pros/cons</h2>
                <p>
                <table>
                    <thead>
                    <tr>
                        <th>Positives</th>
                        <th>Negatives</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <th>
                            <ul style="font-size: 0.7em !important;">
                                <li>Dependency injection</li>
                                <li>Importing modules</li>
                                <li>Mocking with injection</li>
                                <li>Less code in tests</li>
                                <li>Tests module configuration</li>
                            </ul>
                        </th>
                        <th>
                            <ul style="font-size: 0.7em !important;">
                                <li>Performance</li>
                            </ul>
                        </th>
                    </tr>
                    </tbody>
                </table>
                </p>
            </section>
        </section>
        <section>
            <section>
                <h1><a href="https://vsavkin.com/three-ways-to-test-angular-2-components-dcea8e90bd8d">Types of
                    Tests</a></h1>
            </section>
            <section>
                <h2>Shallow Tests</h2>
                <ul>
                    <li>Shallow-render</li>
                    <li>Template testing</li>
                    <li>Component bootstrap testing</li>
                    <li>NgOnInit template set-up testing</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>Shallow-render mit schema 'NO_ERRORS_SCHEMA'</li>
                        <li>soll nicht die Controller Logik testen, sondern nur die template</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h2>Isolated Tests</h2>
                <ul>
                    <li>Controller testing</li>
                    <li>Isolated from other units</li>
                    <li>Mock every dependency (except ZEntity related things)</li>
                    <li>No Angular bootstrap</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>real unit-test</li>
                        <li>no testbed, no module</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h2>Service Tests</h2>
                <ul>
                    <li>Isolated from other units</li>
                    <li>Mock every dependency (except ZEntity related things)</li>
                    <li>TestBed vs non-TestBed tests</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>semi-real unit-test for services</li>
                        <li>no testbed, no module</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h2>Integration/E2E Tests</h2>
                <ul>
                    <li>Protractor</li>
                    <li>Page-object pattern</li>
                    <li>Testing multiple components together, including the services</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>important for caching configuration issues, and wrong use of components, because shallow
                            tests dont cover that.
                        </li>
                    </ul>
                </aside>
            </section>
        </section>
        <section>
            <h1>VIGO NG Testing</h1>
        </section>
    </div>
</div>

<script src="js/reveal.js"></script>

<script>
    // More info about config & dependencies:
    // - https://github.com/hakimel/reveal.js#configuration
    // - https://github.com/hakimel/reveal.js#dependencies
    Reveal.initialize({
        dependencies: [
            {src: 'plugin/markdown/marked.js'},
            {src: 'plugin/markdown/markdown.js'},
            {src: 'plugin/notes/notes.js', async: true},
            {src: 'plugin/highlight/highlight.js', async: true}
        ]
    });
</script>
</body>
</html>
